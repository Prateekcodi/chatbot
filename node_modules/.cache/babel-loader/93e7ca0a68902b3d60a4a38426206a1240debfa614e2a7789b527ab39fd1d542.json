{"ast":null,"code":"import React,{createContext,useContext,useEffect,useState,useCallback}from'react';import{supabase}from'./supabaseClient';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext(undefined);export function AuthProvider(_ref){let{children}=_ref;const[session,setSession]=useState(null);const[user,setUser]=useState(null);useEffect(()=>{supabase.auth.getSession().then(_ref2=>{var _data$session,_data$session$user,_data$session2;let{data}=_ref2;setSession((_data$session=data.session)!==null&&_data$session!==void 0?_data$session:null);setUser((_data$session$user=(_data$session2=data.session)===null||_data$session2===void 0?void 0:_data$session2.user)!==null&&_data$session$user!==void 0?_data$session$user:null);});const{data:sub}=supabase.auth.onAuthStateChange((_event,sess)=>{var _sess$user;setSession(sess);setUser((_sess$user=sess===null||sess===void 0?void 0:sess.user)!==null&&_sess$user!==void 0?_sess$user:null);});return()=>{sub.subscription.unsubscribe();};},[]);const signInWithEmail=useCallback(async(email,password)=>{const{error}=await supabase.auth.signInWithPassword({email,password});return{error:error===null||error===void 0?void 0:error.message};},[]);const signUpWithEmail=useCallback(async(email,password,meta)=>{const{data,error}=await supabase.auth.signUp({email,password,options:{data:meta}});if(!error&&data.user){// Ensure profile row exists\nawait supabase.from('profiles').upsert({id:data.user.id,email,full_name:(meta===null||meta===void 0?void 0:meta.full_name)||null});}return{error:error===null||error===void 0?void 0:error.message};},[]);const signOut=useCallback(async()=>{try{await supabase.auth.signOut();}finally{// Eagerly clear local auth state to update UI immediately\nsetSession(null);setUser(null);try{// Clear Supabase cached tokens in localStorage (best-effort)\nif(typeof window!=='undefined'){const keys=Object.keys(window.localStorage);for(const key of keys){if(key.startsWith('sb-')){window.localStorage.removeItem(key);}}}}catch(_){}}},[]);const value={session,user,signInWithEmail,signUpWithEmail,signOut};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});}export function useAuth(){const ctx=useContext(AuthContext);if(!ctx)throw new Error('useAuth must be used within AuthProvider');return ctx;}","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","useCallback","supabase","jsx","_jsx","AuthContext","undefined","AuthProvider","_ref","children","session","setSession","user","setUser","auth","getSession","then","_ref2","_data$session","_data$session$user","_data$session2","data","sub","onAuthStateChange","_event","sess","_sess$user","subscription","unsubscribe","signInWithEmail","email","password","error","signInWithPassword","message","signUpWithEmail","meta","signUp","options","from","upsert","id","full_name","signOut","window","keys","Object","localStorage","key","startsWith","removeItem","_","value","Provider","useAuth","ctx","Error"],"sources":["/workspace/src/lib/auth.tsx"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState, useCallback } from 'react';\nimport { Session, User } from '@supabase/supabase-js';\nimport { supabase } from './supabaseClient';\n\ninterface AuthContextValue {\n  session: Session | null;\n  user: User | null;\n  signInWithEmail: (email: string, password: string) => Promise<{ error?: string }>\n  signUpWithEmail: (email: string, password: string, meta?: { full_name?: string }) => Promise<{ error?: string }>\n  signOut: () => Promise<void>;\n}\n\nconst AuthContext = createContext<AuthContextValue | undefined>(undefined);\n\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\n  const [session, setSession] = useState<Session | null>(null);\n  const [user, setUser] = useState<User | null>(null);\n\n  useEffect(() => {\n    supabase.auth.getSession().then(({ data }) => {\n      setSession(data.session ?? null);\n      setUser(data.session?.user ?? null);\n    });\n\n    const { data: sub } = supabase.auth.onAuthStateChange((_event, sess) => {\n      setSession(sess);\n      setUser(sess?.user ?? null);\n    });\n    return () => { sub.subscription.unsubscribe(); };\n  }, []);\n\n  const signInWithEmail = useCallback(async (email: string, password: string) => {\n    const { error } = await supabase.auth.signInWithPassword({ email, password });\n    return { error: error?.message };\n  }, []);\n\n  const signUpWithEmail = useCallback(async (email: string, password: string, meta?: { full_name?: string }) => {\n    const { data, error } = await supabase.auth.signUp({ email, password, options: { data: meta } });\n    if (!error && data.user) {\n      // Ensure profile row exists\n      await supabase.from('profiles').upsert({ id: data.user.id, email, full_name: meta?.full_name || null });\n    }\n    return { error: error?.message };\n  }, []);\n\n  const signOut = useCallback(async () => {\n    try {\n      await supabase.auth.signOut();\n    } finally {\n      // Eagerly clear local auth state to update UI immediately\n      setSession(null);\n      setUser(null);\n      try {\n        // Clear Supabase cached tokens in localStorage (best-effort)\n        if (typeof window !== 'undefined') {\n          const keys = Object.keys(window.localStorage);\n          for (const key of keys) {\n            if (key.startsWith('sb-')) {\n              window.localStorage.removeItem(key);\n            }\n          }\n        }\n      } catch (_) {}\n    }\n  }, []);\n\n  const value: AuthContextValue = { session, user, signInWithEmail, signUpWithEmail, signOut };\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n}\n\nexport function useAuth() {\n  const ctx = useContext(AuthContext);\n  if (!ctx) throw new Error('useAuth must be used within AuthProvider');\n  return ctx;\n}\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}